server {
    listen 80;
    server_name 192.168.1.83;

<<<<<<< Updated upstream
    # ?? Directus backend pod /backend
=======
    # ================================
    # Backend Directus (panel admina)
    # ================================
>>>>>>> Stashed changes
    location /backend/ {
        proxy_pass http://directus:8055/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
<<<<<<< Updated upstream
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # ?? Next.js API
    location /api/ {
        proxy_pass http://frontend-new:3000/api/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
=======
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ================================
    # Intranet (Next.js /int)
    # ================================

    # ðŸ‘‡ dokÅ‚adnie Å›cieÅ¼ka /int (bez slasha)
    # NIE redirectuj â€” przekazuj do aplikacji Next.js
    location = /int {
        proxy_pass http://int:3000/int;  # ðŸ”¹ unikamy pÄ™tli /int <-> /int/
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
>>>>>>> Stashed changes
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

<<<<<<< Updated upstream
    # ?? Next.js zasoby
    location /_next/ {
        proxy_pass http://frontend-new:3000/_next/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
=======
    # ðŸ‘‡ obsÅ‚uga /int/ i wszystkich podÅ›cieÅ¼ek
    location ^~ /int/ {
        proxy_pass http://int:3000;  # ðŸ”¹ zachowuje peÅ‚ne URI (np. /int/login)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
>>>>>>> Stashed changes
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

<<<<<<< Updated upstream
    location /static/ {
        proxy_pass http://frontend-new:3000/static/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }

    # ?? Hot reload (tylko w dev)
=======
    # ================================
    # Nowa strona Next.js (frontend-new)
    # ================================
    location = / {
        proxy_pass http://frontend-new:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location ^~ /oferta {
        proxy_pass http://frontend-new:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ObsÅ‚uga WebSocket HMR (Hot Reload)
>>>>>>> Stashed changes
    location /_next/webpack-hmr {
        proxy_pass http://frontend-new:3000/_next/webpack-hmr;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }

<<<<<<< Updated upstream
    # ?? G³ówna aplikacja Next.js
    location / {
        proxy_pass http://frontend-new:3000/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
=======
    # Statyczne zasoby Next.js
    location ^~ /_next/ {
        proxy_pass http://frontend-new:3000;
        proxy_set_header Host $host;
    }

    location ^~ /static/ {
        proxy_pass http://frontend-new:3000;
        proxy_set_header Host $host;
    }

    # API Next.js
    location ^~ /api/ {
        proxy_pass http://frontend-new:3000;
        proxy_set_header Host $host;
    }

    # ================================
    # Stara strona (legacy frontend)
    # ================================
    location / {
        proxy_pass http://188.252.84.185;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
>>>>>>> Stashed changes
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}